import streamlit as st
import random
from PIL import Image
import os
import time

# è®¾ç½®é¡µé¢é…ç½®
st.set_page_config(
    page_title="éšæœºç¾é£Ÿæ¨èå™¨",
    page_icon="ğŸ²",
    layout="centered",
    initial_sidebar_state="expanded"
)


# è·å–å›¾ç‰‡ç»å¯¹è·¯å¾„
def get_image_path(image_name):
    # æ ¹æ®ä½ çš„å®é™…ä½ç½®è°ƒæ•´è·¯å¾„
    return r"C:\Users\Lenovo\Desktop\images" + "\\" + image_name


# åŠ è½½CSSæ ·å¼
def local_css(file_name):
    try:
        with open(file_name, encoding="utf-8") as f:
            st.markdown(f"<style>{f.read()}</style>", unsafe_allow_html=True)
    except Exception as e:
        st.error(f"åŠ è½½æ ·å¼è¡¨é”™è¯¯: {e}")
        st.markdown("""
        <style>
        /* åŸºç¡€æ ·å¼ä½œä¸ºåå¤‡ */
        .stButton>button {
            background-color: #FF4B4B;
            color: white;
            border-radius: 10px;
            border: none;
            padding: 10px 24px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .stButton>button:hover {
            background-color: #FF2B2B;
            transform: scale(1.05);
        }
        </style>
        """, unsafe_allow_html=True)


# åº”ç”¨CSSæ ·å¼
local_css(r"C:\Users\Lenovo\Desktop\style.css")

# åº”ç”¨æ ‡é¢˜å’Œç®€ä»‹
st.title("ğŸœ éšæœºç¾é£Ÿæ¨èå™¨")
st.markdown("""
æ¢ç´¢ä¸–ç•Œå„åœ°çš„ç¾é£Ÿï¼é€‰æ‹©ä¸€ä¸ªèœç³»ï¼Œæˆ‘ä»¬å°†ä¸ºæ‚¨éšæœºæ¨èä¸€é“ç»å…¸èœè‚´ï¼Œå¹¶é™„ä¸Šè¯¦ç»†ä»‹ç»å’Œçƒ¹é¥ªå°è´´å£«ã€‚
""")

# ç¾é£Ÿæ•°æ®åº“
food_database = {
    "ä¸­é¤": [
        {
            "name": "å®«ä¿é¸¡ä¸",
            "image": "kung_pao_chicken.jpg",
            "description": "å®«ä¿é¸¡ä¸æ˜¯ä¸€é“ç»å…¸çš„å·èœï¼Œä»¥é¸¡è‚‰ã€èŠ±ç”Ÿç±³ã€è¾£æ¤’å’ŒèŠ±æ¤’ä¸ºä¸»è¦åŸæ–™ï¼Œå£å‘³éº»è¾£é²œé¦™ï¼Œç•¥å¸¦ç”œé…¸ã€‚",
            "tips": "å…³é”®æŠ€å·§ï¼šé¸¡ä¸å…ˆç”¨è›‹æ¸…å’Œæ·€ç²‰è…Œåˆ¶ï¼Œä¿æŒè‚‰è´¨å«©æ»‘ï¼›æœ€ååŠ å…¥èŠ±ç”Ÿç±³å¿«é€Ÿç¿»ç‚’ï¼Œä¿æŒè„†åº¦ã€‚"
        },
        {
            "name": "éº»å©†è±†è…",
            "image": "mapo_tofu.jpg",
            "description": "éº»å©†è±†è…æ˜¯å››å·ä¼ ç»Ÿåèœï¼Œä¸»è¦åŸæ–™ä¸ºè±†è…ã€ç‰›è‚‰æœ«ã€è¾£æ¤’å’ŒèŠ±æ¤’ï¼Œå…·æœ‰éº»ã€è¾£ã€çƒ«ã€é¦™ã€é…¥ã€å«©ã€é²œã€æ´»çš„ç‰¹ç‚¹ã€‚",
            "tips": "ä½¿ç”¨å«©è±†è…æ•ˆæœæœ€ä½³ï¼›æœ€åæ’’ä¸ŠèŠ±æ¤’ç²‰å’Œè‘±èŠ±ï¼Œé£å‘³æ›´ä½³ã€‚"
        },
        {
            "name": "åŒ—äº¬çƒ¤é¸­",
            "image": "peking_duck.jpg",
            "description": "åŒ—äº¬çƒ¤é¸­äº«èª‰ä¸–ç•Œï¼Œä»¥å…¶çš®è„†è‚‰å«©ã€è‰²æ³½çº¢è‰³è€Œé—»åã€‚ä¼ ç»Ÿåƒæ³•æ˜¯ç”¨è–„é¥¼åŒ…è£¹é¸­è‚‰ã€é»„ç“œæ¡å’Œç”œé¢é…±ã€‚",
            "tips": "é¸­å­éœ€ç»è¿‡å¹æ°”ã€çƒ«çš®ã€æŒ‚ç³–ç­‰å¤šé“å·¥åºï¼›çƒ¤åˆ¶æ—¶ç«å€™æ§åˆ¶æ˜¯å…³é”®ã€‚"
        }
    ],
    "æ„å¤§åˆ©é¤": [
        {
            "name": "ç›æ ¼ä¸½ç‰¹æŠ«è¨",
            "image": "margherita_pizza.jpg",
            "description": "ç»å…¸æ„å¤§åˆ©æŠ«è¨ï¼Œä»¥ç•ªèŒ„é…±ã€æ–°é²œé©¬è‹é‡Œæ‹‰å¥¶é…ªå’Œç½—å‹’å¶ä¸ºé…æ–™ï¼Œä»£è¡¨æ„å¤§åˆ©å›½æ——çš„çº¢ã€ç™½ã€ç»¿ä¸‰è‰²ã€‚",
            "tips": "é¢å›¢éœ€å……åˆ†å‘é…µï¼›ä½¿ç”¨çŸ³çª‘çƒ¤ç‚‰èƒ½è·å¾—æœ€ä½³å£æ„Ÿï¼›æ–°é²œç½—å‹’å¶åœ¨å‡ºç‚‰åæ·»åŠ ã€‚"
        },
        {
            "name": "æ„å¤§åˆ©è‚‰é…±é¢",
            "image": "spaghetti_bolognese.jpg",
            "description": "åšæ´›å°¼äºšä¼ ç»Ÿç¾é£Ÿï¼Œç”±ç‰›è‚‰æœ«ã€ç•ªèŒ„é…±ã€æ´‹è‘±ã€èƒ¡èåœå’ŒèŠ¹èœæ…¢ç‚–æ•°å°æ—¶åˆ¶æˆï¼Œé…ä»¥æ„å¤§åˆ©é¢ã€‚",
            "tips": "è‚‰é…±éœ€å°ç«æ…¢ç‚–è‡³å°‘2å°æ—¶ï¼›ä½¿ç”¨å®½é¢æ¡å¦‚tagliatelleæ›´ä¼ ç»Ÿã€‚"
        },
        {
            "name": "ææ‹‰ç±³è‹",
            "image": "tiramisu.jpg",
            "description": "æ„å¤§åˆ©ç»å…¸ç”œç‚¹ï¼Œç”±æµ¸æ³¡è¿‡å’–å•¡å’Œæœ—å§†é…’çš„æ‰‹æŒ‡é¥¼å¹²ã€é©¬æ–¯å¡å½­å¥¶é…ªå’Œå¯å¯ç²‰å±‚å±‚å åŠ è€Œæˆã€‚",
            "tips": "ä½¿ç”¨æ–°é²œé¸¡è›‹ï¼›å¥¶é…ªéœ€å®¤æ¸©è½¯åŒ–ï¼›å†·è—è‡³å°‘4å°æ—¶åå†äº«ç”¨ã€‚"
        }
    ],
    "æ—¥æœ¬æ–™ç†": [
        {
            "name": "å¯¿å¸æ‹¼ç›˜",
            "image": "sushi_platter.jpg",
            "description": "æ—¥æœ¬ä»£è¡¨æ€§ç¾é£Ÿï¼Œç”±é†‹é¥­å’Œå„ç§æµ·é²œç»„æˆã€‚å¸¸è§çš„æœ‰é‡‘æªé±¼ã€ä¸‰æ–‡é±¼ã€è™¾å’Œé³—é±¼ç­‰ã€‚",
            "tips": "ç±³é¥­éœ€ç”¨ä¸“ç”¨å¯¿å¸é†‹è°ƒå‘³ï¼›æ–°é²œæµ·é²œæ˜¯å…³é”®ï¼›èŠ¥æœ«åº”æŠ¹åœ¨é±¼ç”Ÿè€Œéé…±æ²¹ä¸­ã€‚"
        },
        {
            "name": "æ‹‰é¢",
            "image": "ramen.jpg",
            "description": "æ—¥å¼æ±¤é¢ï¼Œç”±æµ“éƒéª¨æ±¤ã€é¢æ¡å’Œå„ç§é…æ–™ï¼ˆå¦‚å‰çƒ§è‚‰ã€æºå¿ƒè›‹ã€æµ·è‹”ã€ç«¹ç¬‹ï¼‰ç»„æˆã€‚",
            "tips": "æ±¤åº•éœ€ç†¬åˆ¶8å°æ—¶ä»¥ä¸Šï¼›é¢æ¡ç…®è‡³al denteçŠ¶æ€ï¼›æºå¿ƒè›‹ç…®6åˆ†é’Ÿæœ€ä½³ã€‚"
        },
        {
            "name": "å¤©å¦‡ç½—",
            "image": "tempura.jpg",
            "description": "æ—¥å¼ç‚¸ç‰©ï¼Œå°†æµ·é²œå’Œè”¬èœè£¹ä¸Šç‰¹åˆ¶é¢ç³Šåæ²¹ç‚¸è€Œæˆï¼Œä»¥é…¥è„†è½»ç›ˆçš„å£æ„Ÿä¸ºç‰¹ç‚¹ã€‚",
            "tips": "é¢ç³Šéœ€å†·è—ä¸”ä¸è¿‡åº¦æ…æ‹Œï¼›æ²¹æ¸©æ§åˆ¶åœ¨170-180Â°Cï¼›ç«‹å³äº«ç”¨å£æ„Ÿæœ€ä½³ã€‚"
        }
    ],
    "å¢¨è¥¿å“¥é¤": [
        {
            "name": "å¡”å¯",
            "image": "tacos.jpg",
            "description": "å¢¨è¥¿å“¥ä¼ ç»Ÿé£Ÿç‰©ï¼Œç”±ç‰ç±³æˆ–å°éº¦è–„é¥¼åŒ…è£¹å„ç§é¦…æ–™ï¼Œå¦‚ç‰›è‚‰ã€é¸¡è‚‰ã€è”¬èœã€èèé…±å’Œé³„æ¢¨é…±ã€‚",
            "tips": "ç‰ç±³é¥¼éœ€åŠ çƒ­è½¯åŒ–ï¼›æ–°é²œåˆ¶ä½œçš„èèé…±é£å‘³æ›´ä½³ï¼›æ·»åŠ é’æŸ æ±æé²œã€‚"
        },
        {
            "name": "å¢¨è¥¿å“¥å·é¥¼",
            "image": "burrito.jpg",
            "description": "å¤§å°ºå¯¸é¢ç²‰è–„é¥¼åŒ…è£¹ç±³é¥­ã€è±†ç±»ã€è‚‰ç±»ã€å¥¶é…ªå’Œèèé…±ç­‰ä¸°å¯Œé¦…æ–™ï¼Œè¥å…»å‡è¡¡ä¸”é¥±è…¹æ„Ÿå¼ºã€‚",
            "tips": "é¦…æ–™éœ€æ²¥å¹²æ°´åˆ†ï¼›å·é¥¼æ—¶éœ€ç´§å¯†åŒ…è£¹ï¼›å¯çƒ˜çƒ¤ä½¿è¡¨é¢é…¥è„†ã€‚"
        },
        {
            "name": "é³„æ¢¨é…±",
            "image": "guacamole.jpg",
            "description": "ä»¥é³„æ¢¨ä¸ºä¸»æ–™ï¼ŒåŠ å…¥ç•ªèŒ„ã€æ´‹è‘±ã€é¦™èœå’Œé’æŸ æ±åˆ¶æˆçš„ç»å…¸å¢¨è¥¿å“¥è˜¸é…±ï¼Œæ¸…æ–°å¥åº·ã€‚",
            "tips": "ä½¿ç”¨æˆç†Ÿä½†ä¸è¿‡è½¯çš„é³„æ¢¨ï¼›ç«‹å³åŠ å…¥é’æŸ æ±é˜²æ­¢æ°§åŒ–ï¼›ä¿ç•™æœæ ¸å»¶ç¼“å˜è‰²ã€‚"
        }
    ],
    "å°åº¦èœ": [
        {
            "name": "å’–å–±é¸¡",
            "image": "chicken_curry.jpg",
            "description": "å°åº¦æœ€å—æ¬¢è¿çš„èœè‚´ä¹‹ä¸€ï¼Œé¸¡è‚‰åœ¨ç”±å¤šç§é¦™æ–™ç†¬åˆ¶çš„æµ“éƒå’–å–±é…±æ±ä¸­æ…¢ç‚–è€Œæˆï¼Œé…ä»¥ç±³é¥­æˆ–çƒ¤é¥¼ã€‚",
            "tips": "ä½¿ç”¨å®Œæ•´é¦™æ–™å¹²ç‚’é‡Šæ”¾é¦™æ°”ï¼›åŠ å…¥é…¸å¥¶ä½¿è‚‰è´¨æ›´å«©ï¼›æœ€ååŠ å…¥å¥¶æ²¹å¢åŠ æµ“éƒå£æ„Ÿã€‚"
        },
        {
            "name": "å°åº¦çƒ¤é¥¼",
            "image": "naan.jpg",
            "description": "ä¼ ç»Ÿå°åº¦å‘é…µé¢é¥¼ï¼Œåœ¨æ³¥ç‚‰ä¸­çƒ¤åˆ¶è€Œæˆï¼Œå¤–é…¥å†…è½¯ï¼Œå¸¸æ­é…å’–å–±é£Ÿç”¨ã€‚",
            "tips": "é¢å›¢éœ€å……åˆ†å‘é…µï¼›çƒ¤åˆ¶å‰æ¶‚æŠ¹é»„æ²¹æˆ–è’œè“‰ï¼›è¶çƒ­é£Ÿç”¨å£æ„Ÿæœ€ä½³ã€‚"
        },
        {
            "name": "å°åº¦é¦™é¥­",
            "image": "biryani.jpg",
            "description": "å°åº¦ç‹å®¤èœè‚´ï¼Œç”±é•¿ç²’é¦™ç±³ã€è‚‰ç±»ã€è”¬èœå’Œå¤šç§é¦™æ–™å±‚å±‚å åŠ è’¸åˆ¶è€Œæˆï¼Œé¦™æ°”æµ“éƒã€‚",
            "tips": "ç±³é¥­é¢„å…ˆåŠç†Ÿï¼›ä½¿ç”¨è—çº¢èŠ±æ°´æŸ“è‰²ï¼›å¯†å°å®¹å™¨è’¸åˆ¶ä¿æŒé¦™æ°”ã€‚"
        }
    ]
}


# åˆ›å»ºå ä½å›¾ç‰‡
def create_placeholder_image(text, width=400, height=300):
    from PIL import Image, ImageDraw, ImageFont
    img = Image.new('RGB', (width, height), color=(73, 109, 137))
    draw = ImageDraw.Draw(img)
    try:
        # å°è¯•åŠ è½½ä¸­æ–‡å­—ä½“
        font = ImageFont.truetype("simhei.ttf", 30)
    except:
        try:
            # å°è¯•å…¶ä»–å¸¸è§å­—ä½“
            font = ImageFont.truetype("arial.ttf", 30)
        except:
            # æœ€åä½¿ç”¨é»˜è®¤å­—ä½“
            font = ImageFont.load_default()

    # è®¡ç®—æ–‡æœ¬ä½ç½®
    text_width = font.getlength(text)
    text_height = 30  # è¿‘ä¼¼å€¼
    draw.text(((width - text_width) // 2, (height - text_height) // 2),
              text, font=font, fill=(255, 255, 255))
    return img


# åŠ è½½é£Ÿç‰©å›¾ç‰‡
def load_food_image(image_name):
    try:
        image_path = get_image_path(image_name)
        if os.path.exists(image_path):
            return Image.open(image_path)
        else:
            st.warning(f"å›¾ç‰‡æœªæ‰¾åˆ°: {image_path}")
            return create_placeholder_image(image_name.split('.')[0].replace('_', ' ').title())
    except Exception as e:
        st.error(f"åŠ è½½å›¾ç‰‡é”™è¯¯: {e}")
        return create_placeholder_image("å›¾ç‰‡åŠ è½½å¤±è´¥")


# ä¾§è¾¹æ 
with st.sidebar:
    st.header("ğŸ½ï¸ é€‰æ‹©ä½ çš„ç¾é£Ÿä¹‹æ—…")
    cuisine = st.selectbox("é€‰æ‹©èœç³»", list(food_database.keys()), index=0)

    st.markdown("---")
    st.markdown("### çƒ¹é¥ªåå¥½")
    spice_level = st.slider("è¾£åº¦åå¥½", 0, 5, 2)
    cooking_time = st.selectbox("çƒ¹é¥ªæ—¶é—´", ["15åˆ†é’Ÿå†…", "30åˆ†é’Ÿ", "1å°æ—¶", "2å°æ—¶ä»¥ä¸Š"])

    st.markdown("---")
    st.markdown("### å…³äºæœ¬åº”ç”¨")
    st.markdown("""
    è¿™ä¸ªéšæœºç¾é£Ÿæ¨èå™¨æ—¨åœ¨å¸®åŠ©æ‚¨ï¼š
    - å‘ç°ä¸–ç•Œå„åœ°ç¾é£Ÿ
    - å°è¯•æ–°çš„çƒ¹é¥ªä½“éªŒ
    - è·å–ä¸“ä¸šçƒ¹é¥ªæŠ€å·§
    - æ‹“å±•æ‚¨çš„ç¾é£Ÿè§†é‡
    """)

# æ¨èæŒ‰é’®
col1, col2, col3 = st.columns([1, 2, 1])
with col2:
    if st.button("ğŸ² éšæœºæ¨èç¾é£Ÿ", use_container_width=True):
        # è·å–éšæœºç¾é£Ÿ
        foods = food_database[cuisine]
        selected_food = random.choice(foods)

        # æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        with st.spinner(f'æ­£åœ¨ä¸ºæ‚¨æŒ‘é€‰å®Œç¾çš„{cuisine}ç¾é£Ÿ...'):
            time.sleep(1.5)

        # æ˜¾ç¤ºç»“æœ
        st.subheader(f"ä»Šæ—¥æ¨èï¼š{selected_food['name']}")

        # æ˜¾ç¤ºç¾é£Ÿå›¾ç‰‡
        food_image = load_food_image(selected_food["image"])
        st.image(food_image, caption=selected_food["name"], use_column_width=True)

        # æ˜¾ç¤ºç¾é£Ÿä¿¡æ¯
        st.markdown(f"**èœç³»**: {cuisine}")
        st.markdown(f"**ç®€ä»‹**: {selected_food['description']}")
        st.markdown(f"**ğŸ‘¨â€ğŸ³ çƒ¹é¥ªå°è´´å£«**: {selected_food['tips']}")

        # æ·»åŠ ä¸€äº›è£…é¥°å…ƒç´ 
        st.balloons()
        st.success("å‘ç°ç¾é£ŸæˆåŠŸï¼ç¥æ‚¨çƒ¹é¥ªæ„‰å¿«ï¼")

        # è¥å…»ä¿¡æ¯ï¼ˆæ¨¡æ‹Ÿï¼‰
        with st.expander("ğŸ“Š è¥å…»ä¿¡æ¯ï¼ˆæ¯ä»½ï¼‰"):
            st.markdown("""
            | è¥å…»æˆåˆ† | å«é‡ |
            |----------|------|
            | å¡è·¯é‡Œ   | 350-550 kcal |
            | è›‹ç™½è´¨   | 20-30g |
            | ç¢³æ°´åŒ–åˆç‰© | 40-60g |
            | è„‚è‚ª     | 15-25g |
            """)

        # ç”¨æˆ·åé¦ˆ
        st.markdown("---")
        st.subheader("æ‚¨çš„åé¦ˆ")
        rating = st.slider("æ‚¨å–œæ¬¢è¿™ä¸ªæ¨èå—ï¼Ÿ", 1, 5, 3)
        if st.button("æäº¤åé¦ˆ"):
            st.success(f"æ„Ÿè°¢æ‚¨çš„è¯„åˆ†ï¼š{rating}é¢—æ˜Ÿï¼æˆ‘ä»¬å°†æ ¹æ®æ‚¨çš„åé¦ˆæ”¹è¿›æ¨èã€‚")
    else:
        st.info("ğŸ‘† ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è·å–éšæœºç¾é£Ÿæ¨èï¼")

# é¡µè„š
st.markdown("---")
st.markdown("""
<div style="text-align: center; padding: 10px;">
    <p>ğŸ´ ç”¨ä»£ç çƒ¹é¥ªç¾é£Ÿ | éšæœºç¾é£Ÿæ¨èå™¨ Â© 2023</p>
    <p>æ¢ç´¢ä¸–ç•Œç¾é£Ÿï¼Œå¼€å¯å‘³è•¾ä¹‹æ—…</p>
</div>
""", unsafe_allow_html=True)